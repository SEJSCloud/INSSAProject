<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>키워드로 장소검색하기</title>

</head>

<body>
    <input type="text" id="id">
    <button onclick="drawMap()">검색</button><br>
    <button onclick="getData()">추출</button>
    <form action="saveLocation" method="GET">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
        <input type="text" name="">
    </form>
    <button onclick="saveData()">저장</button>
    <div id="map" style="width:100%;height:350px;"></div>

    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=00f87dfc64daeb277224676ae0cf3f88&libraries=services"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다

        var array = [];
        function getData() {
            axios.get("http://127.0.0.1:8000/load")
                .then(resData => {
                    console.log(resData.data);
                    for (let i = 0; i < resData.data[0].length; i++) {
                        // 장소 검색 객체를 생성합니다
                        var ps = new kakao.maps.services.Places();
                        var num = 0;
                        ps.keywordSearch(resData.data[0][i].sourceAsMap.place, placesSearchCB);
                        function placesSearchCB(data, status, pagination) {
                            if (status === kakao.maps.services.Status.OK) {
                                array.push(data[0]);
                                array[num].esId = resData.data[0][i].id;
                                num++;
                            }
                        }
                    }

                    console.log(array);
                })
                .catch(error => {
                    console.log("비정상 응답 ", error);
                });
        }
        function saveData() {
            sub = "saveLocation?esId=" + array.esId + "&addressName=" + array.address_name + "&categoryGroupCode=" + array.category_group_code +
                "&categoryGroupName=" + array.category_group_name + "&categoryName=" + array.category_name + "&distance=" + array.distance + "&id=" + array.id +
                "&phone=" + array.phone + "&placeName=" + array.place_name + "&placeUrl=" + array.place_url + "&roadAddressName=" + array.road_address_name +
                "&x=" + array.x + "&y=" + array.y;
            axios.get("http://127.0.0.1:8000/" + sub)
                .then(resData => {
                    console.log(123);
                })
                .catch(error => {
                    console.log("비정상 응답 ", error);
                });
        }
    </script>
</body>

</html>