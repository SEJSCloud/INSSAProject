<html>
<head>
    <meta charset="utf-8" />
    <link href="https://fonts.googleapis.com/css?family=Black+Han+Sans|Gugi&display=swap" rel="stylesheet">
    <title>IN-SSAIT</title>
</head> 
<style>
body {
  text-align: center;
  margin: 0 auto;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 17px;
}
  
.container {
  padding: 0px;
  background-color: white;
}

.content {
  position: fixed;
  bottom: 0px;
  background: rgb(0, 0, 0); /* Fallback color */
  background: rgba(0, 0, 0, 0.4);
  color: #f1f1f1;
  height: 140px;
  width: 100%;
  padding: 10px;
  text-align: center;
}
  
.pill-nav a {
  display: inline-block;
  color: black;
  text-align: center;
  padding: 14px;
  text-decoration: none;
  font-size: 17px;
  border-radius: 5px;
}

.pill-nav a:hover {
  background-color: #ddd;
  color: black;
}
p{
font-size: 25px;
}

 
</style>
<body>
<br>
  <h2>inSSa-it, 갖고 싶으신가요?</h2>
  <hr>
<div class="pill-nav">
  <a href="http://localhost:8000/login.html">Login</a>
  <a href="http://localhost:8000/signUp.html">Signup</a>
</div>
<div class="content">
  <P id=timeNow></P><p>The Hottest Places in Korea Now!!</p>
</div>

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"
        type="text/JavaScript"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
	playAlert = setInterval(function() {
		var dateMonth = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul",
			"Aug", "Sep", "Oct", "Nov", "Dec" ]
	var dateDay = [ "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" ];
	var date = new Date();
	var dateY = date.getFullYear();
	var dateD = date.getDate();
	var timeH = date.getHours();
	var timeM = date.getMinutes();
	var timeS = date.getSeconds();
	document.getElementById("timeNow").innerHTML = dateDay[date.getDay()]
			+ " " + dateMonth[date.getMonth()] + " " + dateD + " "
			+ dateY + " " + timeH + ":" + timeM + ":" + timeS;
		}, 600);
        axios.get("http://127.0.0.1:8000/getLocationInfo")
            .then(resData => {
                var vArray = [];
                for (let i = 0; i < resData.data.length; i++) {
                    if (Object.keys(resData.data[i].sourceAsMap).includes("place_url")) {
                        vArray.push(resData.data[i].sourceAsMap);
                    }
                }

                var keyArray = [];
                var checked = [];               
                vArray.forEach((element) => {
                    if(element.road_address_name != ""){
                        if(checked.includes(element.road_address_name.split(" ")[1])){
                            let index = checked.indexOf(element.road_address_name.split(" ")[1]);
                            keyArray[index].frequency+=1;
                        }else{
                            checked.push(element.road_address_name.split(" ")[1]);
                            keyArray.push({'text' : element.road_address_name.split(" ")[1], 'frequency' : 1});
                        }
                    }
                }) 

                //Word Cloud
                var width = 1370,
                    height = 400
                var svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height);
                d3.csv("", function (data) {
                    showCloud(keyArray)
                    setInterval(function () {
                        showCloud(keyArray)
                    }, 2000)
                });                 
                wordScale = d3.scale.linear().domain([0, 100]).range([0, 150]).clamp(true);
                var svg = d3.select("svg")
                    .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
                function showCloud(data) {
                    d3.layout.cloud().size([width, height])                      
                        .words(data)
                        .rotate(function (d) {
                            return d.frequency > 10 ? 0 : 0;
                        })                         
                        .fontSize(function (d) {
                            return wordScale(d.frequency);
                        })                     
                        .on("end", draw)
                        .start();
                 function draw(words) {
                     var cloud = svg.selectAll("text").data(words)                    
                     cloud.enter()
                         .append("text")
                         .style("font-family", "Black Han Sans")
                         .style("fill", "#405275")
                         .style("fill-opacity", 0.3)
                         .attr("text-anchor", "height")
                         .attr('font-size', 1)
                         .text(function (d) {
                             return d.text;
                         });
                     cloud
                         .transition()
                         .duration(600)
                         .style("font-size", function (d) {
                             return Math.log10(d.frequency)*50 + "px";
                         })
                         .attr("transform", function (d) {
                             return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                         })
                         .style("fill-opacity", 1);
                    }
                }

            })
            .catch(error => {
                console.log("비정상 응답 ", error);
            });

    </script>  
</body>
</html>